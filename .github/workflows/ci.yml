# This is a basic workflow Continuous integration for testing application

name: CI

# Controls when the action will run. 
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main, feature/1614-make-more-test-and-refacto-CI ]
  pull_request:
    branches: [ main, feature/1614-make-more-test-and-refacto-CI ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:

  
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v1

      # Runs a single command using the runners shell
      - name: Run installation
        run: |
          wget https://raw.githubusercontent.com/hestiacp/hestiacp/release/install/hst-install.sh
          sudo apt-get update && sudo apt-get install ca-certificates -y
          sudo bash hst-install-ubuntu.sh --force

      - name: Setup BATS
        uses: mig4/setup-bats@v1
        with:
          bats-version: 1.2.1

      - name: Check out code
        uses: actions/checkout@v2

      - name: Test
        run: |
          echo Test Pipeline CI
          git clone --recurse-submodules https://github.com/hestiacp/hestiacp
          cd hestiacp/
          # Install Bats 
          test/test_helper/bats-core/install.sh /usr/local
          # Run Testia tests
          test/test.bats
